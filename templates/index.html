<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Stock Management</title>
    <style>
        body {
            background-color: #7092e9;
            font-family: Arial, sans-serif;
        }

        h1 {
            color: #000000;
        }

        table {
            width: 70%;
            border-collapse: collapse;
            margin-top: -20px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        th, td {
            border: 1px solid #000000;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #ffffff;
        }

        td:first-child {
            width: 15%; /* Set rack number column width */
        }

        td:nth-last-child(2) {
            width: 60%; /* Set prediction result column width */
        }
        td:last-child{
            width: 6%;
        }

        label {
            margin-top: 10px;
            display: block;
            color: #555;
            /*text-align: right;*/
            margin-left: 80%;
        }

        input[type="text"] {
            position: relative;
            margin-left: 80%;

        }
        #colr{
            height: 10px;
            width: 10px;
            background-color: aqua;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('update_result', function(data) {
            // Update the results on the webpage
            for (var rack in data.rack_results) {
                var result_id = 'result_rack_' + rack;
                var result_text = data.rack_results[rack].prediction_result;
                var colr_id='colr'+rack;
                // Display QR result if available
                if (data.rack_results[rack].qr_result) {
                    result_text += ' | QR Result: ' + data.rack_results[rack].qr_result;
                }

                document.getElementById(result_id).innerText = result_text;
                document.getElementById(colr_id).style.width='20px';
                document.getElementById(colr_id).style.height='20px';
                if(result_text == 0){
                document.getElementById(colr_id).style.backgroundColor='red';
                }
                else{
                    document.getElementById(colr_id).style.backgroundColor='green';
                }
            }
        });

        function searchResults() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("resultTable");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[1]; // Index 1 corresponds to the "Prediction Result" column
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>
</head>
<body>
    <h1>Automated Stock Management</h1>
    <label for="searchInput">Search Prediction Result:</label>
    <input type="text" id="searchInput" onkeyup="searchResults()" placeholder="Type to search...">
    
    <table id="resultTable">
        <thead>
            <tr>
                <th>Rack Number</th>
                <th>Prediction Result</th>
                <th>Colour</th>
            </tr>
        </thead>
        <tbody>
            {% for rack in range(1, 21) %}
                <tr>
                    <td>Rack {{ rack }}</td>
                    <td id="result_rack_{{ rack }}">Waiting for prediction...</td>
                    <td><div id="colr{{ rack }}"></div></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>


    <!--##############{displaying cap image}###############-->
    <div style="position: absolute; bottom: 10px; right: 10px;">
        <img id="capturedImage" src="" alt="Captured Image" style="max-width: 300px; max-height: 300px;">
    </div>

    <!-- Start and Stop buttons -->
    <div style="margin-top: 20px;">
        <button onclick="startPrediction()">Start Prediction</button>
        <button onclick="stopPrediction()">Stop Prediction</button>
    </div>

    <!-- <div id="billingSection" style="margin-top: 20px;"> -->
        <h2>Billing</h2>
        <label for="rackNumberInput">Enter Rack Number:</label>
        <input type="number" id="rackNumberInput" placeholder="Rack Number">
        <!-- <button onclick="fetchBilling()">Show Billing</button> -->
        <label for="customerNameInput">Customer Name:</label>
        <input type="text" id="customerNameInput" placeholder="Enter customer's name">

        <label for="rackPriceInput">Rack Price:</label>
        <input type="text" id="rackPriceInput" placeholder="Enter rack price">

        <label for="productQuantityInput">Product Quantity:</label>
        <input type="text" id="productQuantityInput" placeholder="Enter product quantity">
        <label for="customerMobileInput">Customer Mobile Number:</label>
        <input type="text" id="customerMobileInput" placeholder="Enter customer's mobile number">


        <button onclick="showBilling()">Show Billing</button>

    <div id="billingSection" style="margin-top: 20px;">
        <div id="billingResult">
            <!-- Billing results will be displayed here -->
        </div>
    </div>
    <button onclick="clearBilling()">Clear Billing</button>
    

    <!-- Include JavaScript code to update the image source -->
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);
    
        // Update the captured image when received from the server
        socket.on('update_image', function(data) {
            var capturedImage = document.getElementById('capturedImage');
            capturedImage.src = 'data:image/jpeg;base64,' + data.captured_frame;
        });
    
        // Function to start the prediction process
        function startPrediction() {
            socket.emit('start_prediction');
        }
    
        // Function to stop the prediction process
        function stopPrediction() {
            socket.emit('stop_prediction');
        }
    
        // Function to fetch billing information based on rack number
        function fetchBilling() {
            var rackNumber = document.getElementById('rackNumberInput').value;
            socket.emit('fetch_billing', { rackNumber: rackNumber });
        }

        function clearBilling() {
            var billingSection = document.getElementById('billingSection');
            billingSection.innerHTML = ''; // Clear the content of the billing section
        }

        function showBilling() {
            var rackNumber = document.getElementById('rackNumberInput').value;
            var customerName = document.getElementById('customerNameInput').value;
            var customerMobile = document.getElementById('customerMobileInput').value;
            var rackPrice = document.getElementById('rackPriceInput').value;
            var productQuantity = document.getElementById('productQuantityInput').value;
            
            // Emit rack number, customer name, customer mobile, rack price, and product quantity to fetch billing information
            socket.emit('fetch_billing', {
                'rackNumber': rackNumber,
                'customerName': customerName,
                'customerMobile': customerMobile,
                'rackPrice': rackPrice,
                'productQuantity': productQuantity
            });
        }




    
//         // Update billing section when received from the server
//         socket.on('update_billing', function(data) {
//             var billingSection = document.getElementById('billingSection');
//             if (data.billingResult) {
//                 // If billing data is found, display it
//                 var billingResult = JSON.stringify(data.billingResult);
//                 var qrResult = data.qrResult ? data.qrResult : "No QR result available";
//                 billingSection.innerHTML = '<p>Billing Information:</p><p>' + billingResult + '</p><p>QR Result:</p><p>' + qrResult + '</p>';
//             } else {
//                 // If no billing data is found, display a message
//                 billingSection.innerHTML = '<p>No billing data found for the entered rack number.</p>';
//     }
// });

socket.on('update_billing', function(data) {
    var billingSection = document.getElementById('billingSection');
    if (data.billingResult) {
        // If billing data is found, display it
        var billingResult = JSON.stringify(data.billingResult);
        var qrResult = data.qrResult ? data.qrResult : "No QR result available";
        var customerName = data.customerName ? "Customer Name: " + data.customerName : "";
        var customerMobile = data.customerMobile ? "Customer Mobile: " + data.customerMobile : "";
        billingSection.innerHTML = '<p>Billing Information:</p><p>' + billingResult + '</p>' +
                                    '<p>' + customerName + '</p>' +
                                    '<p>' + customerMobile + '</p>' +
                                    '<p>QR Result:</p><p>' + qrResult + '</p>';
    } else {
        // If no billing data is found, display a message
        billingSection.innerHTML = '<p>No billing data found for the entered rack number.</p>';
    }
});


    </script>
    <!--###################################################-->
    

</body>
</html>
